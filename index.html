<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shahriar's Private Site</title>

  <style>
    /* -------- Base layout -------- */
    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, #f5f7fa, #e4e9f0);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .card {
      background: white;
      width: 100%;
      max-width: 420px;
      padding: 28px 24px 32px;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.08);
    }

    h1, h2 {
      margin-top: 0;
      margin-bottom: 12px;
    }

    h1 {
      font-size: 1.8rem;
    }

    h2 {
      font-size: 1.4rem;
    }

    p {
      margin: 8px 0 16px;
      color: #333;
      line-height: 1.5;
    }

    /* -------- Inputs & buttons -------- */
    input[type="email"] {
      width: 100%;
      padding: 12px 14px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    button {
      font-size: 1rem;
      padding: 12px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }

    .btn {
      width: 100%;
      margin-top: 8px;
      background: #2563eb;
      color: white;
    }

    .btn.secondary {
      background: #e5e7eb;
      color: #111;
    }

    .btn:active {
      transform: translateY(1px);
    }

    #message {
      margin-top: 12px;
      font-size: 0.95rem;
    }

    /* -------- Tablet & up -------- */
    @media (min-width: 768px) {
      .card {
        max-width: 480px;
        padding: 32px 28px 36px;
      }

      h1 {
        font-size: 2rem;
      }
    }

    /* Header bar */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 18px;
    }
    
    .brand {
      font-weight: 700;
      font-size: 1.05rem;
      color: #111;
    }
    
    .navBtn {
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      background: white;
      color: #111;
      cursor: pointer;
    }
    
    .navBtn:active {
      transform: translateY(1px);
    }
    
    /* Page content */
    .page h1 {
      margin-top: 0;
    }
    
    .contentBlock {
      margin-top: 14px;
      padding: 14px;
      border-radius: 12px;
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
    }
    
    .contentBlock h3 {
      margin: 0 0 6px;
      font-size: 1.05rem;
    }
  </style>
</head>

<body>

  <div class="card">

    <!-- PUBLIC INFO -->
    <div id="public">
      <div class="header">
        <div class="brand">Shahriar‚Äôs Private Site</div>
        <button id="loginBtn" class="navBtn">Login</button>
      </div>
    
      <div class="page">
        <h1>Welcome üëã</h1>
        <p>This is my personal space for friends & family.</p>
    
        <!-- You will add content here later -->
        <div class="contentBlock">
          <h3>Public content</h3>
          <p>(Placeholder) You can add announcements, links, photos, notes, etc. here later.</p>
        </div>
    
        <div class="contentBlock">
          <h3>What‚Äôs inside (private)</h3>
          <p>(Placeholder) Some content is available only after login.</p>
        </div>
      </div>
    </div>
  
    <!-- LOGIN -->
    <div id="login" style="display:none;">
      <h2>Login</h2>
      <p>Use Google or receive a login link by email.</p>
  
      <button id="googleBtn" class="btn">Continue with Google</button>
      <br><br>
  
      <input type="email" id="email" placeholder="Enter your email" />
      <br><br>
  
      <button id="sendLinkBtn" class="btn">Send Login Link</button>
      <br><br>
  
      <button id="backBtn" class="navBtn">‚Üê Back</button>
  
      <p id="message"></p>
    </div>
  
    <!-- PRIVATE CONTENT -->
    <div id="content" style="display:none;">
      <div class="header">
        <div class="brand">Private Area üîí</div>
        <button id="logoutBtn" class="navBtn">Logout</button>
      </div>
    
      <div class="page">
        <h1>Welcome!</h1>
        <p>You‚Äôre logged in. Private content will appear here.</p>
    
        <!-- You will add private content here later -->
        <div class="contentBlock">
          <h3>Private content</h3>
          <p>(Placeholder) Add your private notes, links, or anything else here later.</p>
        </div>
      </div>
    </div>
  
  </div>

  <script type="module">
    /* ===============================
       1) ALLOWED EMAILS (EDIT THIS)
       =============================== */
    const ALLOWED_EMAILS = new Set([
      "prism.shahriar@gmail.com",
      "prism.nadia@gmail.com",
    ]);

    /* ===============================
       2) FIREBASE IMPORTS
       =============================== */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      sendSignInLinkToEmail,
      isSignInWithEmailLink,
      signInWithEmailLink,
      onAuthStateChanged,
      signOut,
      setPersistence,
      browserSessionPersistence
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    /* ===============================
       3) FIREBASE CONFIG (YOURS)
       =============================== */
    const firebaseConfig = {
      apiKey: "AIzaSyAPPNbdQDSBuVGsX3cGBS-LSuiv04BMlBk",
      authDomain: "personal-private-site-a1442.firebaseapp.com",
      projectId: "personal-private-site-a1442",
      storageBucket: "personal-private-site-a1442.firebasestorage.app",
      messagingSenderId: "504980056764",
      appId: "1:504980056764:web:951b50e94b74620d507eb9"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    await setPersistence(auth, browserSessionPersistence);
    const provider = new GoogleAuthProvider();

    /* ===============================
       4) UI HELPERS
       =============================== */
    const elPublic = document.getElementById("public");
    const elLogin = document.getElementById("login");
    const elContent = document.getElementById("content");
    const msg = document.getElementById("message");

    function show(section) {
      elPublic.style.display = section === "public" ? "block" : "none";
      elLogin.style.display = section === "login" ? "block" : "none";
      elContent.style.display = section === "content" ? "block" : "none";
      msg.textContent = "";
    }

    document.getElementById("loginBtn").onclick = () => show("login");
    document.getElementById("backBtn").onclick = () => show("public");

    /* ===============================
       5) GOOGLE SIGN-IN
       =============================== */
    document.getElementById("googleBtn").onclick = async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        const email = (result.user.email || "").toLowerCase();

        if (!ALLOWED_EMAILS.has(email)) {
          await signOut(auth);
          msg.textContent = "This Google account is not authorized.";
          show("login");
        }
      } catch (e) {
        msg.textContent = "Google sign-in failed.";
      }
    };

    /* ===============================
       6) EMAIL LINK SIGN-IN
       =============================== */
    document.getElementById("sendLinkBtn").onclick = async () => {
      const email = document.getElementById("email").value.trim().toLowerCase();

      if (!email) {
        msg.textContent = "Please enter an email.";
        return;
      }
      if (!ALLOWED_EMAILS.has(email)) {
        msg.textContent = "This email is not authorized.";
        return;
      }

      const actionCodeSettings = {
        url: "https://md-shahriar-mahmud.github.io/",
        handleCodeInApp: true
      };

      try {
        await sendSignInLinkToEmail(auth, email, actionCodeSettings);
        localStorage.setItem("emailForSignIn", email);
        msg.textContent = "Login link sent. Check your email.";
      } catch {
        msg.textContent = "Failed to send login link.";
      }
    };

    if (isSignInWithEmailLink(auth, window.location.href)) {
      let email = localStorage.getItem("emailForSignIn");
      if (!email) {
        email = prompt("Confirm your email:");
      }
      if (email && ALLOWED_EMAILS.has(email.toLowerCase())) {
        await signInWithEmailLink(auth, email, window.location.href);
        localStorage.removeItem("emailForSignIn");
        window.history.replaceState({}, document.title, "/");
      }
    }

    /* ===============================
       7) AUTH STATE + LOGOUT
       =============================== */
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const email = (user.email || "").toLowerCase();
        if (!ALLOWED_EMAILS.has(email)) {
          await signOut(auth);
          show("login");
        } else {
          show("content");
        }
      } else {
        show("public");
      }
    });

    document.getElementById("logoutBtn").onclick = async () => {
      await signOut(auth);
      show("public");
    };
  </script>
</body>
</html>
